<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>ì£¼ì‹ RADAR ğŸ“¡</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&family=IBM+Plex+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0c10;
  --s1: #111520;
  --s2: #181e2c;
  --border: #1f2636;
  --up: #ff4560;
  --up-bg: rgba(255,69,96,.12);
  --acc: #00c8e8;
  --acc-bg: rgba(0,200,232,.1);
  --dn: #26de81;
  --gold: #ffd32a;
  --text: #d0daea;
  --dim: #4a5572;
  --dim2: #2a3040;
  --mono: 'IBM Plex Mono', monospace;
  --sans: 'Noto Sans KR', sans-serif;
  --radius: 10px;
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}
* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html, body { height:100%; background:var(--bg); color:var(--text); font-family:var(--sans); overflow-x:hidden; }

/* â”€â”€ HEADER â”€â”€ */
.header {
  position:sticky; top:0; z-index:100;
  padding:12px 16px 10px;
  background:rgba(10,12,16,.95);
  border-bottom:1px solid var(--border);
  backdrop-filter:blur(16px);
  -webkit-backdrop-filter:blur(16px);
  display:flex; align-items:center; justify-content:space-between;
}
.logo { font-size:17px; font-weight:900; letter-spacing:1px; }
.logo em { color:var(--up); font-style:normal; }
.header-right { display:flex; align-items:center; gap:8px; }
.clock { font-family:var(--mono); font-size:10px; color:var(--dim); }
.api-dot { width:8px; height:8px; border-radius:50%; background:var(--dim); }
.api-dot.ok { background:var(--dn); box-shadow:0 0 8px var(--dn); }

/* â”€â”€ TABS â”€â”€ */
.tabs {
  display:flex; background:var(--s1);
  border-bottom:1px solid var(--border);
  overflow-x:auto; scrollbar-width:none;
}
.tabs::-webkit-scrollbar { display:none; }
.tab {
  flex:1; min-width:70px; padding:11px 8px;
  font-size:12px; font-weight:700; text-align:center;
  color:var(--dim); border:none; background:none;
  cursor:pointer; white-space:nowrap;
  border-bottom:2px solid transparent;
  transition:all .15s;
}
.tab.on { color:var(--up); border-bottom-color:var(--up); }

/* â”€â”€ MAIN â”€â”€ */
.main { padding:12px 12px calc(12px + var(--safe-bottom)); }
.page { display:none; }
.page.on { display:block; }

/* â”€â”€ API KEY CARD â”€â”€ */
.api-card {
  background:linear-gradient(135deg, rgba(255,69,96,.08), rgba(0,200,232,.06));
  border:1px solid rgba(255,69,96,.3);
  border-radius:var(--radius); padding:14px; margin-bottom:12px;
}
.api-card.hidden { display:none; }
.api-card-title { font-size:12px; font-weight:700; color:var(--up); margin-bottom:10px; }
.api-row { display:flex; gap:8px; }
.api-inp {
  flex:1; font-family:var(--mono); font-size:12px;
  background:var(--s2); border:1px solid var(--border);
  border-radius:7px; padding:9px 12px; color:var(--text); outline:none;
}
.api-inp:focus { border-color:var(--acc); }
.api-save-btn {
  font-family:var(--sans); font-size:12px; font-weight:700;
  background:var(--up); color:#fff; border:none; border-radius:7px;
  padding:9px 16px; cursor:pointer; white-space:nowrap;
}
.api-hint {
  font-size:10px; color:var(--dim); margin-top:8px; line-height:1.6;
}
.api-link { color:var(--acc); text-decoration:none; }

/* â”€â”€ ACTION BAR â”€â”€ */
.action-bar {
  background:var(--s1); border:1px solid var(--border);
  border-radius:var(--radius); padding:10px; margin-bottom:10px;
  display:flex; flex-direction:column; gap:8px;
}
.action-row { display:flex; gap:8px; align-items:center; }
.date-inp {
  flex:1; font-family:var(--mono); font-size:13px;
  background:var(--s2); border:1px solid var(--border);
  border-radius:7px; padding:9px 10px; color:var(--text); outline:none;
}
.date-inp:focus { border-color:var(--acc); }
.btn {
  font-family:var(--sans); font-size:12px; font-weight:700;
  padding:9px 16px; border-radius:7px; border:none; cursor:pointer;
  display:flex; align-items:center; justify-content:center; gap:5px;
  white-space:nowrap; transition:all .15s; min-width:44px; min-height:44px;
}
.btn-up { background:var(--up); color:#fff; }
.btn-up:active { background:#d93050; }
.btn-acc { background:var(--acc-bg); color:var(--acc); border:1px solid rgba(0,200,232,.3); }
.btn-ghost { background:var(--s2); color:var(--dim); border:1px solid var(--border); }
.btn:disabled { opacity:.35; }
.action-meta { font-family:var(--mono); font-size:10px; color:var(--dim); text-align:center; }

/* â”€â”€ STATS â”€â”€ */
.stats-grid {
  display:grid; grid-template-columns:1fr 1fr;
  gap:8px; margin-bottom:10px;
}
.stat {
  background:var(--s1); border:1px solid var(--border);
  border-radius:var(--radius); padding:10px 12px;
  border-left:3px solid var(--border);
}
.stat.r { border-left-color:var(--up); }
.stat.b { border-left-color:var(--acc); }
.stat.g { border-left-color:var(--dn); }
.stat.o { border-left-color:var(--gold); }
.stat-lbl { font-size:9px; font-weight:700; color:var(--dim); letter-spacing:.6px; text-transform:uppercase; margin-bottom:4px; }
.stat-val { font-family:var(--mono); font-size:15px; font-weight:700; }
.stat-val.r { color:var(--up); }
.stat-val.b { color:var(--acc); }
.stat-val.g { color:var(--dn); }
.stat-val.o { color:var(--gold); }
.stat-val.sm { font-size:11px; color:var(--text); }

/* â”€â”€ SECTION â”€â”€ */
.section { margin-bottom:10px; }
.section-hd {
  display:flex; align-items:center; justify-content:space-between;
  padding:9px 12px; background:var(--s2); border-radius:var(--radius) var(--radius) 0 0;
  border:1px solid var(--border); border-bottom:none;
}
.section-title { font-size:12px; font-weight:700; display:flex; align-items:center; gap:6px; }
.badge {
  font-size:8px; font-weight:700; padding:2px 5px; border-radius:3px;
  letter-spacing:.4px; text-transform:uppercase;
}
.badge-r { background:var(--up-bg); color:var(--up); }
.badge-b { background:var(--acc-bg); color:var(--acc); }
.badge-g { background:rgba(38,222,129,.1); color:var(--dn); }
.badge-p { background:rgba(165,94,234,.1); color:#b48be8; }
.section-meta { font-family:var(--mono); font-size:9px; color:var(--dim); }

/* â”€â”€ STOCK LIST (mobile cards) â”€â”€ */
.stock-list {
  background:var(--s1); border:1px solid var(--border);
  border-radius:0 0 var(--radius) var(--radius);
  overflow:hidden;
}
.stock-item {
  display:flex; align-items:center; gap:10px;
  padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.03);
}
.stock-item:last-child { border-bottom:none; }
.stock-item:active { background:rgba(255,255,255,.02); }
.s-rank {
  font-family:var(--mono); font-size:11px; font-weight:700;
  color:var(--dim2); width:22px; text-align:center; flex-shrink:0;
}
.s-rank.g1 { color:var(--gold); }
.s-rank.g2 { color:#a0aab8; }
.s-rank.g3 { color:#8a6848; }
.s-info { flex:1; min-width:0; }
.s-name { font-size:13px; font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.s-reason { font-size:10px; color:var(--dim); margin-top:1px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.s-right { display:flex; flex-direction:column; align-items:flex-end; gap:3px; flex-shrink:0; }
.s-rate {
  font-family:var(--mono); font-size:13px; font-weight:700; color:var(--up);
}
.s-rate.lim { color:#ff6b81; }
.s-vol { font-family:var(--mono); font-size:10px; color:var(--acc); }
.s-kw { display:flex; justify-content:flex-end; }

/* â”€â”€ KEYWORD TAG â”€â”€ */
.tag {
  display:inline-block; font-size:9px; font-weight:700;
  padding:2px 5px; border-radius:2px; white-space:nowrap;
}
.tag-ì¦ê¶Œ { background:rgba(255,69,96,.12); color:#ff6b81; }
.tag-ì œì•½ë°”ì´ì˜¤ { background:rgba(38,222,129,.12); color:#69db7c; }
.tag-ë°˜ë„ì²´ { background:rgba(0,200,232,.12); color:var(--acc); }
.tag-ìš°ì£¼í•­ê³µ { background:rgba(165,94,234,.12); color:#c084fc; }
.tag-ì›ì „ { background:rgba(255,211,42,.12); color:var(--gold); }
.tag-skê·¸ë£¹ { background:rgba(255,69,96,.1); color:#ff8fa3; }
.tag-ì§€ì£¼ì‚¬ { background:rgba(120,130,150,.12); color:#9ca3af; }
.tag-ë¡œë´‡ { background:rgba(0,200,232,.1); color:#67e8f9; }
.tag-ë°©ì‚° { background:rgba(255,211,42,.1); color:var(--gold); }
.tag-ë‚¨ë¶ê²½í˜‘ { background:rgba(100,180,255,.1); color:#93c5fd; }
.tag-2ì°¨ì „ì§€ { background:rgba(38,222,129,.1); color:#86efac; }
.tag-íƒœì–‘ê´‘ { background:rgba(255,211,42,.08); color:#fde047; }
.tag-ìë™ì°¨ { background:rgba(255,159,67,.1); color:#fdba74; }
.tag-í†µì‹  { background:rgba(100,149,237,.1); color:#93b4f5; }
.tag-ê°œë³„ì´ìŠˆ { background:rgba(100,110,130,.1); color:#6b7280; }
.tag-def { background:rgba(80,90,110,.1); color:#6b7280; }

/* â”€â”€ KW BAR â”€â”€ */
.kw-section { background:var(--s1); border:1px solid var(--border); border-radius:0 0 var(--radius) var(--radius); padding:10px 12px; }
.kw-row { display:flex; align-items:center; gap:7px; margin-bottom:6px; }
.kw-row:last-child { margin-bottom:0; }
.kw-i { font-family:var(--mono); font-size:9px; color:var(--dim2); width:12px; text-align:right; flex-shrink:0; }
.kw-bar-bg { flex:1; height:4px; background:var(--s2); border-radius:2px; overflow:hidden; }
.kw-bar-fill { height:100%; border-radius:2px; background:var(--up); transition:width .5s; }
.kw-cnt { font-family:var(--mono); font-size:9px; color:var(--dim); width:18px; text-align:right; flex-shrink:0; }
.kw-vol-txt { font-family:var(--mono); font-size:9px; color:var(--acc); width:52px; text-align:right; flex-shrink:0; }

/* â”€â”€ CALENDAR â”€â”€ */
.cal-nav {
  display:flex; align-items:center; gap:8px;
  padding:10px 12px; background:var(--s1);
  border:1px solid var(--border); border-radius:var(--radius) var(--radius) 0 0;
  border-bottom:none;
}
.cal-btn {
  width:32px; height:32px; border-radius:7px;
  border:1px solid var(--border); background:var(--s2);
  color:var(--text); font-size:16px; cursor:pointer;
  display:flex; align-items:center; justify-content:center;
}
.cal-btn:active { background:var(--border); }
.cal-month { font-family:var(--mono); font-size:14px; font-weight:700; flex:1; text-align:center; }
.cal-wrap { background:var(--s1); border:1px solid var(--border); border-radius:0 0 var(--radius) var(--radius); overflow:hidden; }
.cal-grid { display:grid; grid-template-columns:repeat(5,1fr); }
.cal-hd { padding:8px 4px; text-align:center; font-family:var(--mono); font-size:9px; font-weight:700; color:var(--dim); background:var(--s2); border-bottom:1px solid var(--border); }
.cal-hd.mon { color:var(--up); }
.cal-hd.fri { color:var(--acc); }
.cal-cell { border-right:1px solid var(--border); border-bottom:1px solid var(--border); min-height:80px; padding:6px; }
.cal-cell:nth-child(5n) { border-right:none; }
.cal-cell.empty { background:rgba(0,0,0,.3); }
.cal-cell.has { border-top:2px solid var(--up); cursor:pointer; }
.cal-cell.has:active { background:rgba(255,69,96,.04); }
.cal-d { font-family:var(--mono); font-size:10px; font-weight:700; color:var(--dim); margin-bottom:4px; }
.cal-kw-mini { display:flex; flex-direction:column; gap:2px; }
.cal-kw-nm { font-size:9px; font-weight:700; color:var(--text); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.cal-kw-vl { font-family:var(--mono); font-size:8px; color:var(--acc); }

/* â”€â”€ MANUAL INPUT â”€â”€ */
.manual-section { background:var(--s1); border:1px solid var(--border); border-radius:var(--radius); overflow:hidden; margin-bottom:10px; }
.manual-hd { padding:10px 12px; background:var(--s2); border-bottom:1px solid var(--border); font-size:12px; font-weight:700; display:flex; align-items:center; justify-content:space-between; }
.manual-items { padding:8px; display:flex; flex-direction:column; gap:6px; }
.manual-item { background:var(--s2); border:1px solid var(--border); border-radius:7px; padding:10px; }
.manual-item-row { display:grid; grid-template-columns:50px 1fr 70px 70px; gap:6px; margin-bottom:6px; }
.manual-item-row2 { display:grid; grid-template-columns:1fr 100px 28px; gap:6px; }
.m-inp {
  font-family:var(--sans); font-size:12px;
  background:var(--bg); border:1px solid var(--border); border-radius:5px;
  padding:7px 8px; color:var(--text); outline:none; width:100%;
}
.m-inp:focus { border-color:var(--acc); }
.m-inp::placeholder { color:var(--dim2); font-size:11px; }
.m-sel {
  font-family:var(--sans); font-size:11px;
  background:var(--bg); border:1px solid var(--border); border-radius:5px;
  padding:7px 4px; color:var(--text); outline:none; width:100%;
}
.m-lbl { font-size:9px; color:var(--dim); margin-bottom:2px; letter-spacing:.3px; }
.rm-btn {
  background:none; border:1px solid var(--border2); border-radius:5px;
  color:var(--dim); cursor:pointer; width:28px; height:100%;
  display:flex; align-items:center; justify-content:center; font-size:13px;
}
.add-btn {
  margin:0 8px 8px; padding:9px; border-radius:7px;
  border:1px dashed var(--border); background:none;
  color:var(--dim); font-size:11px; font-weight:700;
  cursor:pointer; width:calc(100% - 16px); font-family:var(--sans);
}
.save-row { padding:0 8px 8px; display:flex; gap:8px; }

/* â”€â”€ AI THINKING â”€â”€ */
.ai-box {
  background:rgba(0,200,232,.05); border:1px solid rgba(0,200,232,.2);
  border-radius:var(--radius); padding:16px; text-align:center;
  display:flex; flex-direction:column; align-items:center; gap:8px;
}
.ai-box-txt { font-size:12px; color:var(--acc); }
.dots { display:flex; gap:5px; justify-content:center; }
.dot {
  width:6px; height:6px; border-radius:50%; background:var(--acc);
  animation:bounce .8s ease-in-out infinite;
}
.dot:nth-child(2) { animation-delay:.15s; }
.dot:nth-child(3) { animation-delay:.3s; }
@keyframes bounce { 0%,80%,100%{transform:translateY(0)} 40%{transform:translateY(-7px)} }

/* â”€â”€ MODAL (bottom sheet) â”€â”€ */
.overlay {
  display:none; position:fixed; inset:0; background:rgba(0,0,0,.7);
  z-index:200; align-items:flex-end; justify-content:center;
}
.overlay.on { display:flex; }
.sheet {
  background:var(--s1); border-radius:18px 18px 0 0;
  width:100%; max-height:85vh; overflow:hidden;
  display:flex; flex-direction:column;
  border-top:1px solid var(--border);
}
.sheet-hd {
  padding:14px 16px 12px; display:flex; align-items:center; justify-content:space-between;
  border-bottom:1px solid var(--border);
}
.sheet-handle {
  position:absolute; top:8px; left:50%; transform:translateX(-50%);
  width:36px; height:4px; border-radius:2px; background:var(--border);
}
.sheet-title { font-size:14px; font-weight:700; }
.sheet-x { background:none; border:none; color:var(--dim); font-size:18px; cursor:pointer; padding:4px; }
.sheet-body { overflow-y:auto; padding:12px; flex:1; -webkit-overflow-scrolling:touch; }

/* â”€â”€ EMPTY / TOAST â”€â”€ */
.empty { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:36px 16px; gap:8px; }
.empty-ico { font-size:32px; }
.empty-msg { font-size:13px; color:var(--dim); text-align:center; }
.empty-sub { font-size:11px; color:var(--dim2); text-align:center; }
.toast {
  position:fixed; bottom:calc(16px + var(--safe-bottom)); left:12px; right:12px; z-index:300;
  padding:12px 16px; border-radius:10px; font-size:13px; font-weight:700;
  text-align:center; opacity:0; transition:opacity .2s; pointer-events:none;
}
.toast.ok { background:var(--dn); color:#000; }
.toast.err { background:var(--up); color:#fff; }
.toast.info { background:var(--acc); color:#000; }
.toast.show { opacity:1; }
</style>
</head>
<body>

<!-- HEADER -->
<header class="header">
  <div class="logo"><em>ì£¼ì‹</em>RADAR ğŸ“¡</div>
  <div class="header-right">
    <div class="clock" id="clock"></div>
    <div class="api-dot" id="apiDot"></div>
  </div>
</header>

<!-- TABS -->
<div class="tabs">
  <button class="tab on" onclick="goTab('daily',this)">ğŸ“… ì¼ê°„</button>
  <button class="tab" onclick="goTab('monthly',this)">ğŸ“† ì›”ê°„</button>
  <button class="tab" onclick="goTab('input',this)">âœï¸ ì…ë ¥</button>
  <button class="tab" onclick="goTab('settings',this)">âš™ï¸ ì„¤ì •</button>
</div>

<div class="main">

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• ì¼ê°„ PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-daily" class="page on">

  <!-- API Key Card -->
  <div class="api-card" id="apiCard">
    <div class="api-card-title">âš¡ Claude API í‚¤ ì…ë ¥ (ìµœì´ˆ 1íšŒ)</div>
    <div class="api-row">
      <input class="api-inp" id="apiInp" type="password" placeholder="sk-ant-api03-...">
      <button class="api-save-btn" onclick="saveKey()">ì €ì¥</button>
    </div>
    <div class="api-hint">
      ğŸ‘‰ <a class="api-link" href="https://console.anthropic.com" target="_blank">console.anthropic.com</a> ì ‘ì† â†’ íšŒì›ê°€ì… â†’ API Keys â†’ Create Key<br>
      ğŸ”’ í‚¤ëŠ” ì´ ê¸°ê¸°ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤. í•˜ë£¨ 1íšŒ ìˆ˜ì§‘ ì‹œ ì›” ~500ì›
    </div>
  </div>

  <!-- Action Bar -->
  <div class="action-bar">
    <div class="action-row">
      <input type="date" class="date-inp" id="collectDate">
      <button class="btn btn-up" id="btnAI" onclick="aiCollect()">ğŸ¤– AIìˆ˜ì§‘</button>
    </div>
    <div class="action-row">
      <input type="date" class="date-inp" id="viewDate" onchange="loadView()">
      <button class="btn btn-acc" onclick="loadView()">ì¡°íšŒ</button>
      <button class="btn btn-ghost" onclick="deleteDay()">ğŸ—‘</button>
    </div>
    <div class="action-meta" id="actionMeta">ë‚ ì§œ ì„ íƒ í›„ AIìˆ˜ì§‘ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”</div>
  </div>

  <!-- Content area -->
  <div id="dailyContent">
    <div class="empty">
      <div class="empty-ico">ğŸ“¡</div>
      <div class="empty-msg">ë‚ ì§œë¥¼ ì„ íƒí•˜ê³ <br>AIìˆ˜ì§‘ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”</div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• ì›”ê°„ PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-monthly" class="page">
  <div class="section" style="margin-bottom:10px">
    <div class="cal-nav">
      <button class="cal-btn" onclick="changeMonth(-1)">â€¹</button>
      <div class="cal-month" id="calMonth"></div>
      <button class="cal-btn" onclick="changeMonth(1)">â€º</button>
    </div>
    <div class="cal-wrap">
      <div class="cal-grid">
        <div class="cal-hd mon">ì›”</div>
        <div class="cal-hd">í™”</div>
        <div class="cal-hd">ìˆ˜</div>
        <div class="cal-hd">ëª©</div>
        <div class="cal-hd fri">ê¸ˆ</div>
      </div>
      <div class="cal-grid" id="calBody"></div>
    </div>
  </div>
  <div class="section">
    <div class="section-hd">
      <div class="section-title">ğŸ·ï¸ ì›”ê°„ í‚¤ì›Œë“œ <span class="badge badge-p">MONTHLY</span></div>
    </div>
    <div class="kw-section" id="kwMonthly" style="border-radius:0 0 var(--radius) var(--radius)"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• ìˆ˜ë™ì…ë ¥ PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-input" class="page">
  <div style="display:flex;gap:8px;margin-bottom:10px;align-items:center;">
    <input type="date" class="date-inp" id="manualDate" style="flex:1">
    <button class="btn btn-ghost" onclick="loadSample()" style="font-size:11px;padding:9px 12px;">ìƒ˜í”Œ</button>
  </div>

  <div class="manual-section">
    <div class="manual-hd">
      <span style="color:var(--up)">â–² ìƒìŠ¹ë¥  TOP</span>
      <button onclick="addMRow('rise')" style="font-size:11px;background:none;border:none;color:var(--acc);font-weight:700;cursor:pointer;">+ ì¶”ê°€</button>
    </div>
    <div class="manual-items" id="riseItems"></div>
  </div>

  <div class="manual-section">
    <div class="manual-hd">
      <span style="color:var(--acc)">â— ê±°ë˜ëŒ€ê¸ˆ</span>
      <button onclick="addMRow('vol')" style="font-size:11px;background:none;border:none;color:var(--acc);font-weight:700;cursor:pointer;">+ ì¶”ê°€</button>
    </div>
    <div class="manual-items" id="volItems"></div>
  </div>

  <div style="display:flex;gap:8px;">
    <button class="btn btn-up" style="flex:1" onclick="saveManual()">ğŸ’¾ ì €ì¥</button>
    <button class="btn btn-ghost" onclick="clearManual()">ì´ˆê¸°í™”</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• ì„¤ì • PAGE â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-settings" class="page">
  <div class="manual-section">
    <div class="manual-hd">âš™ï¸ API í‚¤ ì„¤ì •</div>
    <div style="padding:12px;display:flex;flex-direction:column;gap:10px;">
      <div>
        <div class="m-lbl">Claude API Key</div>
        <input class="m-inp" id="settingKey" type="password" placeholder="sk-ant-api03-...">
      </div>
      <button class="btn btn-up" style="width:100%" onclick="saveKeyFromSettings()">ì €ì¥</button>
      <div style="font-size:11px;color:var(--dim);line-height:1.7;">
        ğŸ“Œ í‚¤ ë°œê¸‰ ë°©ë²•:<br>
        1. <a href="https://console.anthropic.com" target="_blank" style="color:var(--acc)">console.anthropic.com</a> ì ‘ì†<br>
        2. êµ¬ê¸€ë¡œ íšŒì›ê°€ì…<br>
        3. API Keys â†’ Create Key<br>
        4. sk-ant- ë¡œ ì‹œì‘í•˜ëŠ” í‚¤ ë³µì‚¬ í›„ ìœ„ì— ë¶™ì—¬ë„£ê¸°
      </div>
    </div>
  </div>

  <div class="manual-section">
    <div class="manual-hd">ğŸ“Š ì €ì¥ëœ ë°ì´í„°</div>
    <div style="padding:12px;display:flex;flex-direction:column;gap:8px;">
      <div style="font-family:var(--mono);font-size:12px;color:var(--acc)" id="dataStats"></div>
      <button class="btn btn-ghost" style="width:100%;font-size:11px" onclick="exportData()">ğŸ“¤ ë°ì´í„° ë‚´ë³´ë‚´ê¸° (JSON)</button>
      <button class="btn btn-ghost" style="width:100%;font-size:11px;color:var(--up);border-color:var(--up)" onclick="clearAll()">ğŸ—‘ ì „ì²´ ë°ì´í„° ì‚­ì œ</button>
    </div>
  </div>

  <div class="manual-section">
    <div class="manual-hd">â„¹ï¸ ì‚¬ìš© ë°©ë²•</div>
    <div style="padding:12px;font-size:12px;color:var(--dim);line-height:2;">
      1ï¸âƒ£ ì„¤ì •íƒ­ì—ì„œ API í‚¤ ì…ë ¥<br>
      2ï¸âƒ£ ì¼ê°„íƒ­ì—ì„œ ë‚ ì§œ ì„ íƒ<br>
      3ï¸âƒ£ ğŸ¤– AIìˆ˜ì§‘ ë²„íŠ¼ í´ë¦­<br>
      4ï¸âƒ£ 15ì´ˆ í›„ ë°ì´í„° ìë™ ì™„ì„±!<br>
      5ï¸âƒ£ ì›”ê°„íƒ­ì—ì„œ ìº˜ë¦°ë” í™•ì¸<br><br>
      âœï¸ ì§ì ‘ ì…ë ¥: ì…ë ¥íƒ­ ì‚¬ìš©<br>
      ğŸ’¾ ë°ì´í„°ëŠ” ì´ ê¸°ê¸°ì— ìë™ì €ì¥
    </div>
  </div>
</div>

</div><!-- /main -->

<!-- Bottom Sheet Modal -->
<div class="overlay" id="overlay" onclick="closeSheet(event)">
  <div class="sheet">
    <div style="position:relative;height:20px;"><div class="sheet-handle"></div></div>
    <div class="sheet-hd">
      <div class="sheet-title" id="sheetTitle"></div>
      <button class="sheet-x" onclick="closeSheet()">âœ•</button>
    </div>
    <div class="sheet-body" id="sheetBody"></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DB_KEY = 'sr_data_v1';
const KEY_KEY = 'sr_apikey';
let db = {};
let currentMonth = new Date();
let rCnt = 0, vCnt = 0;

try { db = JSON.parse(localStorage.getItem(DB_KEY)) || {}; } catch { db = {} }

function saveDB() {
  try { localStorage.setItem(DB_KEY, JSON.stringify(db)); } catch(e) { toast('ì €ì¥ ì‹¤íŒ¨: ìš©ëŸ‰ ì´ˆê³¼', 'err'); }
}
function getKey() { return localStorage.getItem(KEY_KEY) || ''; }

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('DOMContentLoaded', () => {
  const today = toStr(new Date());
  document.getElementById('collectDate').value = today;
  document.getElementById('viewDate').value = today;
  document.getElementById('manualDate').value = today;
  tick(); setInterval(tick, 1000);
  initKey();
  addMRow('rise'); addMRow('vol');
  updateDataStats();
  loadView();
});

function tick() {
  const n = new Date();
  const d = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
  document.getElementById('clock').textContent =
    `${pad(n.getHours())}:${pad(n.getMinutes())}`;
}
function pad(n) { return String(n).padStart(2,'0'); }
function toStr(d) { return d.toISOString().slice(0,10); }

function initKey() {
  const k = getKey();
  const dot = document.getElementById('apiDot');
  const card = document.getElementById('apiCard');
  if (k) { dot.className = 'api-dot ok'; card.style.display = 'none'; }
  else { dot.className = 'api-dot'; card.style.display = 'block'; }
  const si = document.getElementById('settingKey');
  if (si) si.value = k;
}

// â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function goTab(id, btn) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('on'));
  document.querySelectorAll('.tab').forEach(b => b.classList.remove('on'));
  document.getElementById(`page-${id}`).classList.add('on');
  btn.classList.add('on');
  if (id === 'monthly') renderMonthly();
  if (id === 'settings') updateDataStats();
}

// â”€â”€ KEY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveKey() {
  const k = document.getElementById('apiInp').value.trim();
  if (!k.startsWith('sk-ant-')) { toast('ìœ íš¨í•˜ì§€ ì•Šì€ í‚¤ì…ë‹ˆë‹¤', 'err'); return; }
  localStorage.setItem(KEY_KEY, k);
  initKey();
  toast('âœ… API í‚¤ ì €ì¥ ì™„ë£Œ!', 'ok');
}
function saveKeyFromSettings() {
  const k = document.getElementById('settingKey').value.trim();
  if (!k.startsWith('sk-ant-')) { toast('ìœ íš¨í•˜ì§€ ì•Šì€ í‚¤ì…ë‹ˆë‹¤ (sk-ant-...)', 'err'); return; }
  localStorage.setItem(KEY_KEY, k);
  initKey();
  toast('âœ… ì €ì¥ ì™„ë£Œ!', 'ok');
}

// â”€â”€ AI COLLECT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function aiCollect() {
  const key = getKey();
  if (!key) {
    document.getElementById('apiCard').style.display = 'block';
    document.getElementById('apiInp').focus();
    toast('API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”', 'err'); return;
  }
  const date = document.getElementById('collectDate').value;
  if (!date) { toast('ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”', 'err'); return; }

  const btn = document.getElementById('btnAI');
  btn.disabled = true; btn.textContent = 'ìˆ˜ì§‘ ì¤‘...';

  document.getElementById('dailyContent').innerHTML = `
    <div class="ai-box">
      <div class="dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      <div class="ai-box-txt">Claude AIê°€ ${date}<br>ì‹œì¥ ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘...</div>
    </div>`;

  try {
    const result = await claudeFetch(date, key);
    db[date] = result; saveDB();
    document.getElementById('viewDate').value = date;
    renderDaily(date, result);
    toast(`âœ… ìˆ˜ì§‘ ì™„ë£Œ! ìƒìŠ¹ë¥  ${result.rise.length}Â·ê±°ë˜ëŒ€ê¸ˆ ${result.vol.length}ê°œ`, 'ok');
  } catch(e) {
    document.getElementById('dailyContent').innerHTML = `
      <div class="empty">
        <div class="empty-ico">âŒ</div>
        <div class="empty-msg">ìˆ˜ì§‘ ì‹¤íŒ¨</div>
        <div class="empty-sub">${e.message}<br>API í‚¤ë¥¼ í™•ì¸í•˜ê±°ë‚˜ ìˆ˜ë™ì…ë ¥ì„ ì‚¬ìš©í•˜ì„¸ìš”</div>
      </div>`;
    toast('ì‹¤íŒ¨: ' + e.message, 'err');
  } finally {
    btn.disabled = false; btn.innerHTML = 'ğŸ¤– AIìˆ˜ì§‘';
  }
}

async function claudeFetch(date, apiKey) {
  const prompt = `í•œêµ­ ì£¼ì‹ ì „ë¬¸ê°€ë¡œì„œ ${date}ì˜ ì½”ìŠ¤í”¼+ì½”ìŠ¤ë‹¥ ì‹œì¥ ë°ì´í„°ë¥¼ ìƒì„±í•˜ì„¸ìš”.
í•´ë‹¹ ë‚ ì§œ ì „í›„ ì‹¤ì œ ì‹œì¥ íŠ¸ë Œë“œ(í…Œë§ˆ, ì´ìŠˆ, ì„¹í„°)ë¥¼ ìµœëŒ€í•œ ë°˜ì˜í•œ í˜„ì‹¤ì ì¸ ë°ì´í„°ë¥¼ ë§Œë“œì„¸ìš”.

JSONë§Œ ì¶œë ¥ (ë‹¤ë¥¸ í…ìŠ¤íŠ¸ ì—†ì´):
{"rise":[{"rank":1,"name":"ì¢…ëª©ëª…","rate":29.95,"vol":3461,"reason":"ìƒìŠ¹ì´ìœ 30ìì´ë‚´","keyword":"í‚¤ì›Œë“œ"},...30ê°œ],"vol":[{"rank":1,"name":"ì¢…ëª©ëª…","rate":14.42,"vol":24603,"reason":"ì´ìœ ","keyword":"í‚¤ì›Œë“œ"},...30ê°œ]}

keywordëŠ” ë°˜ë“œì‹œ: ì¦ê¶Œ,ì œì•½ë°”ì´ì˜¤,ë°˜ë„ì²´,ìš°ì£¼í•­ê³µ,ì›ì „,SKê·¸ë£¹,ì§€ì£¼ì‚¬,ë¡œë´‡,ë°©ì‚°,ë‚¨ë¶ê²½í˜‘,2ì°¨ì „ì§€,íƒœì–‘ê´‘,ìë™ì°¨,í†µì‹ ,ê°œë³„ì´ìŠˆ ì¤‘ í•˜ë‚˜
rise: rate 25~30%ì—ì„œ ì‹œì‘í•´ ì ì°¨ ê°ì†Œ, volì€ ë‹¤ì–‘í•˜ê²Œ
vol: vol[0].volì€ 15000~30000ì–µ, ì´í›„ ì ê°
í˜„ì‹¤ì ì¸ í•œêµ­ ì£¼ì‹ ì¢…ëª©ëª… ì‚¬ìš©`;

  const r = await fetch('https://api.anthropic.com/v1/messages', {
    method:'POST',
    headers:{'Content-Type':'application/json','x-api-key':apiKey,'anthropic-version':'2023-06-01'},
    body:JSON.stringify({model:'claude-opus-4-6',max_tokens:4000,messages:[{role:'user',content:prompt}]})
  });
  if (!r.ok) {
    const e = await r.json().catch(()=>({}));
    throw new Error(e.error?.message || `ì˜¤ë¥˜ ${r.status}`);
  }
  const d = await r.json();
  const txt = d.content[0]?.text || '';
  const m = txt.match(/\{[\s\S]*\}/);
  if (!m) throw new Error('ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨');
  const p = JSON.parse(m[0]);
  if (!p.rise?.length) throw new Error('ë°ì´í„° ì—†ìŒ');
  return p;
}

// â”€â”€ VIEW / RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadView() {
  const date = document.getElementById('viewDate').value;
  const data = db[date];
  if (!data) {
    document.getElementById('dailyContent').innerHTML = `
      <div class="empty"><div class="empty-ico">ğŸ“­</div>
      <div class="empty-msg">${date || 'ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”'}</div>
      <div class="empty-sub">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div></div>`;
    document.getElementById('actionMeta').textContent = 'ë°ì´í„° ì—†ìŒ';
    return;
  }
  renderDaily(date, data);
}

function renderDaily(date, data) {
  const { rise=[], vol=[] } = data;
  document.getElementById('actionMeta').textContent =
    `${date} Â· ìƒìŠ¹ë¥  ${rise.length} Â· ê±°ë˜ëŒ€ê¸ˆ ${vol.length}`;

  // Stats
  const avg = rise.length ? (rise.reduce((a,b)=>a+b.rate,0)/rise.length).toFixed(1) : 0;
  const totVol = vol.reduce((a,b)=>a+(b.vol||0),0);
  const kwFreq={}, kwVol={};
  [...rise,...vol].forEach(s=>{if(s.keyword){kwFreq[s.keyword]=(kwFreq[s.keyword]||0)+1;kwVol[s.keyword]=(kwVol[s.keyword]||0)+(s.vol||0);}});
  const topKw = Object.entries(kwFreq).sort((a,b)=>b[1]-a[1])[0];

  const integ = buildInteg(rise, vol);

  document.getElementById('dailyContent').innerHTML = `
    <div class="stats-grid">
      <div class="stat r"><div class="stat-lbl">í‰ê· ìƒìŠ¹ë¥ </div><div class="stat-val r">+${avg}%</div></div>
      <div class="stat r"><div class="stat-lbl">ìµœê³ ìƒìŠ¹</div><div class="stat-val sm">${rise[0]?.name||'-'} +${rise[0]?.rate||0}%</div></div>
      <div class="stat b"><div class="stat-lbl">ì´ ê±°ë˜ëŒ€ê¸ˆ</div><div class="stat-val b">${totVol.toLocaleString()}ì–µ</div></div>
      <div class="stat o"><div class="stat-lbl">í•µì‹¬ í‚¤ì›Œë“œ</div><div class="stat-val sm" style="color:var(--gold)">${topKw?topKw[0]+' '+topKw[1]+'ê±´':'-'}</div></div>
    </div>
    ${buildList('ğŸ“ˆ ìƒìŠ¹ë¥  TOP', rise, 'badge-r', 'TOP30')}
    ${buildList('ğŸ’° ê±°ë˜ëŒ€ê¸ˆ ì£¼ë„ì£¼', vol, 'badge-b', 'ê±°ë˜ëŒ€ê¸ˆ')}
    ${buildList('ğŸ”€ í†µí•©ì •ë¦¬', integ, 'badge-g', 'í†µí•©')}
    ${buildKwSection(rise, vol)}
  `;
}

function buildList(title, stocks, badgeCls, badgeTxt) {
  const items = stocks.length ? stocks.map((s,i) => {
    const rk = i===0?'g1':i===1?'g2':i===2?'g3':'';
    const lim = s.rate>=29.5?'lim':'';
    return `<div class="stock-item">
      <div class="s-rank ${rk}">${s.rank||i+1}</div>
      <div class="s-info">
        <div class="s-name">${s.name}</div>
        <div class="s-reason">${s.reason||''}</div>
      </div>
      <div class="s-right">
        <div class="s-rate ${lim}">${s.rate>=0?'+':''}${s.rate}%</div>
        <div class="s-vol">${s.vol?s.vol.toLocaleString()+'ì–µ':''}</div>
        <div class="s-kw">${kwTag(s.keyword)}</div>
      </div>
    </div>`;
  }).join('') : `<div class="empty" style="padding:20px"><div class="empty-msg">ë°ì´í„° ì—†ìŒ</div></div>`;

  return `<div class="section">
    <div class="section-hd">
      <div class="section-title">${title} <span class="badge ${badgeCls}">${badgeTxt}</span></div>
      <span class="section-meta">${stocks.length}ì¢…ëª©</span>
    </div>
    <div class="stock-list">${items}</div>
  </div>`;
}

function buildInteg(rise, vol) {
  const map={};
  rise.forEach(s=>{map[s.name]={...s,_s:'rise'};});
  vol.forEach(s=>{if(map[s.name]){map[s.name].vol=s.vol;map[s.name]._s='both';}else map[s.name]={...s,_s:'vol'};});
  return Object.values(map).sort((a,b)=>(a.keyword||'').localeCompare(b.keyword||'')||b.rate-a.rate).map((s,i)=>({...s,rank:i+1}));
}

function buildKwSection(rise, vol) {
  const kwFreq={}, kwVol={};
  [...rise,...vol].forEach(s=>{if(!s.keyword)return;kwFreq[s.keyword]=(kwFreq[s.keyword]||0)+1;kwVol[s.keyword]=(kwVol[s.keyword]||0)+(s.vol||0);});
  const entries=Object.entries(kwFreq).sort((a,b)=>b[1]-a[1]);
  if(!entries.length) return '';
  const max=entries[0][1];
  const rows=entries.map(([kw,cnt],i)=>`
    <div class="kw-row">
      <span class="kw-i">${i+1}</span>
      ${kwTag(kw)}
      <div class="kw-bar-bg"><div class="kw-bar-fill" style="width:${(cnt/max*100).toFixed(0)}%"></div></div>
      <span class="kw-cnt">${cnt}</span>
      <span class="kw-vol-txt">${(kwVol[kw]||0).toLocaleString()}ì–µ</span>
    </div>`).join('');
  return `<div class="section">
    <div class="section-hd"><div class="section-title">ğŸ·ï¸ í‚¤ì›Œë“œ ë¶„ì„ <span class="badge badge-p">KEYWORD</span></div></div>
    <div class="kw-section">${rows}</div>
  </div>`;
}

// â”€â”€ MONTHLY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderMonthly() {
  const y=currentMonth.getFullYear(), m=currentMonth.getMonth();
  document.getElementById('calMonth').textContent=`${y}ë…„ ${m+1}ì›”`;
  const first=new Date(y,m,1).getDay();
  const days=new Date(y,m+1,0).getDate();
  const offset=first===0?6:first-1;
  let html='';
  for(let e=0;e<offset%5;e++) html+=`<div class="cal-cell empty"></div>`;
  for(let d=1;d<=days;d++){
    const wd=new Date(y,m,d).getDay();
    if(wd===0||wd===6)continue;
    const ds=`${y}-${pad(m+1)}-${pad(d)}`;
    const dd=db[ds]; const has=!!dd;
    let kwHtml='';
    if(has){
      const kf={},kv={};
      [...(dd.rise||[]),...(dd.vol||[])].forEach(s=>{if(!s.keyword)return;kf[s.keyword]=(kf[s.keyword]||0)+1;kv[s.keyword]=(kv[s.keyword]||0)+(s.vol||0);});
      kwHtml=Object.entries(kf).sort((a,b)=>b[1]-a[1]).slice(0,3).map(([kw])=>
        `<div class="cal-kw-nm">${kw}</div>`).join('');
    }
    html+=`<div class="cal-cell ${has?'has':''}" ${has?`onclick="showSheet('${ds}')"`:''}><div class="cal-d">${d}</div><div class="cal-kw-mini">${kwHtml}</div></div>`;
  }
  document.getElementById('calBody').innerHTML=html;

  // Monthly kw stats
  const prefix=`${y}-${pad(m+1)}`;
  const kwFreq={},kwVol={};
  Object.entries(db).filter(([k])=>k.startsWith(prefix)).forEach(([,v])=>{
    [...(v.rise||[]),...(v.vol||[])].forEach(s=>{if(!s.keyword)return;kwFreq[s.keyword]=(kwFreq[s.keyword]||0)+1;kwVol[s.keyword]=(kwVol[s.keyword]||0)+(s.vol||0);});
  });
  const entries=Object.entries(kwFreq).sort((a,b)=>b[1]-a[1]);
  const max=entries[0]?.[1]||1;
  document.getElementById('kwMonthly').innerHTML=entries.length
    ?entries.map(([kw,cnt],i)=>`<div class="kw-row"><span class="kw-i">${i+1}</span>${kwTag(kw)}<div class="kw-bar-bg"><div class="kw-bar-fill" style="width:${(cnt/max*100).toFixed(0)}%"></div></div><span class="kw-cnt">${cnt}</span><span class="kw-vol-txt">${(kwVol[kw]||0).toLocaleString()}ì–µ</span></div>`).join('')
    :`<div class="empty" style="padding:20px"><div class="empty-msg">ì´ë²ˆ ë‹¬ ë°ì´í„° ì—†ìŒ</div></div>`;
}
function changeMonth(d){currentMonth.setMonth(currentMonth.getMonth()+d);renderMonthly();}

// â”€â”€ SHEET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showSheet(date) {
  const data=db[date]; if(!data) return;
  document.getElementById('sheetTitle').textContent=`ğŸ“… ${date}`;
  const integ=buildInteg(data.rise||[],data.vol||[]);
  document.getElementById('sheetBody').innerHTML=
    buildList('ğŸ“ˆ ìƒìŠ¹ë¥ ',data.rise||[],'badge-r','TOP')+
    buildList('ğŸ’° ê±°ë˜ëŒ€ê¸ˆ',data.vol||[],'badge-b','ëŒ€ê¸ˆ')+
    buildList('ğŸ”€ í†µí•©',integ,'badge-g','í†µí•©');
  document.getElementById('overlay').classList.add('on');
}
function closeSheet(e){
  if(!e||e.target===document.getElementById('overlay'))
    document.getElementById('overlay').classList.remove('on');
}

// â”€â”€ MANUAL INPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const KWS=['ì¦ê¶Œ','ì œì•½ë°”ì´ì˜¤','ë°˜ë„ì²´','ìš°ì£¼í•­ê³µ','ì›ì „','SKê·¸ë£¹','ì§€ì£¼ì‚¬','ë¡œë´‡','ë°©ì‚°','ë‚¨ë¶ê²½í˜‘','2ì°¨ì „ì§€','íƒœì–‘ê´‘','ìë™ì°¨','í†µì‹ ','ê°œë³„ì´ìŠˆ'];

function addMRow(type) {
  const idx=type==='rise'?rCnt++:vCnt++;
  const opts=KWS.map(k=>`<option value="${k}">${k}</option>`).join('');
  const html=`<div class="manual-item" id="${type}-mi-${idx}">
    <div class="manual-item-row">
      <div><div class="m-lbl">ìˆœìœ„</div><input class="m-inp" type="number" id="${type}-rk-${idx}" value="${idx+1}"></div>
      <div><div class="m-lbl">ì¢…ëª©ëª…</div><input class="m-inp" type="text" id="${type}-nm-${idx}" placeholder="ì¢…ëª©ëª…"></div>
      <div><div class="m-lbl">ë“±ë½(%)</div><input class="m-inp" type="number" step="0.01" id="${type}-rt-${idx}" placeholder="29.95"></div>
      <div><div class="m-lbl">ê±°ë˜(ì–µ)</div><input class="m-inp" type="number" id="${type}-vl-${idx}" placeholder="3461"></div>
    </div>
    <div class="manual-item-row2">
      <div><div class="m-lbl">ìƒìŠ¹ì´ìœ </div><input class="m-inp" type="text" id="${type}-rs-${idx}" placeholder="ì´ìœ "></div>
      <div><div class="m-lbl">í‚¤ì›Œë“œ</div><select class="m-sel" id="${type}-kw-${idx}"><option value="">-</option>${opts}</select></div>
      <button class="rm-btn" onclick="document.getElementById('${type}-mi-${idx}').remove()">âœ•</button>
    </div>
  </div>`;
  const el=document.createElement('div'); el.innerHTML=html;
  document.getElementById(`${type}Items`).appendChild(el.firstElementChild);
}

function collectM(type) {
  return Array.from(document.querySelectorAll(`[id^="${type}-mi-"]`)).map(row=>{
    const idx=row.id.replace(`${type}-mi-`,'');
    const nm=document.getElementById(`${type}-nm-${idx}`)?.value?.trim();
    if(!nm)return null;
    return {
      rank:parseInt(document.getElementById(`${type}-rk-${idx}`)?.value)||0,
      name:nm,
      rate:parseFloat(document.getElementById(`${type}-rt-${idx}`)?.value)||0,
      vol:parseInt(document.getElementById(`${type}-vl-${idx}`)?.value)||0,
      reason:document.getElementById(`${type}-rs-${idx}`)?.value?.trim()||'',
      keyword:document.getElementById(`${type}-kw-${idx}`)?.value||'',
    };
  }).filter(Boolean).sort((a,b)=>a.rank-b.rank);
}

function saveManual(){
  const date=document.getElementById('manualDate').value;
  if(!date){toast('ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”','err');return;}
  const rise=collectM('rise'), vol=collectM('vol');
  if(!rise.length&&!vol.length){toast('ì¢…ëª©ì„ ì…ë ¥í•˜ì„¸ìš”','err');return;}
  db[date]={rise,vol}; saveDB();
  document.getElementById('viewDate').value=date;
  toast(`âœ… ${date} ì €ì¥ ì™„ë£Œ!`,'ok');
}

function clearManual(){
  document.getElementById('riseItems').innerHTML='';
  document.getElementById('volItems').innerHTML='';
  rCnt=0;vCnt=0;addMRow('rise');addMRow('vol');
}

function loadSample(){
  document.getElementById('manualDate').value='2026-02-13';
  document.getElementById('riseItems').innerHTML='';
  document.getElementById('volItems').innerHTML='';
  rCnt=0;vCnt=0;
  const sr=[
    {rank:1,name:'SKì¦ê¶Œ',rate:29.95,vol:3461,reason:'ë°¸ë¥˜ì—… ê¸°ëŒ€+ì‹¤ì ê°œì„ ',keyword:'ì¦ê¶Œ'},
    {rank:2,name:'ìœ íˆ¬ë°”ì´ì˜¤',rate:29.94,vol:1155,reason:'ì§€ì£¼ì‚¬ ì²´ì œ ì „í™˜ ì†Œì‹',keyword:'ì œì•½ë°”ì´ì˜¤'},
    {rank:3,name:'í˜„ëŒ€ADM',rate:29.93,vol:1938,reason:'ë°”ì´ì˜¤ ì‹ ì•½íŒ€ ê¸°ì§ˆ ì¥ë²½ ì…ì¦',keyword:'ì œì•½ë°”ì´ì˜¤'},
    {rank:5,name:'ìƒì•„í”„ë¡ í…Œí¬',rate:29.84,vol:93,reason:'LEO ì•ˆí…Œë‚˜ í•„ë¦„ ê³µê¸‰',keyword:'ìš°ì£¼í•­ê³µ'},
    {rank:7,name:'ë§ˆì´í¬ë¡œì»¨í…ìŠ¬',rate:26.98,vol:619,reason:'ë°˜ë„ì²´ í”„ë¡œë¸Œì¹´ë“œ',keyword:'ë°˜ë„ì²´'},
  ];
  const sv=[
    {rank:1,name:'ë¯¸ë˜ì—ì…‹ì¦ê¶Œ',rate:14.42,vol:24603,reason:'ì½”ìŠ¤í”¼ ì—­ëŒ€ê¸‰ ë¶ˆì¥',keyword:'ì¦ê¶Œ'},
    {rank:2,name:'SKì´í„°ë‹‰ìŠ¤',rate:22.68,vol:9494,reason:'SK ì‹ ì¬ìƒì—ë„ˆì§€ ì¬í¸',keyword:'SKê·¸ë£¹'},
    {rank:3,name:'í•œêµ­í•­ê³µìš°ì£¼',rate:6.77,vol:6482,reason:'KAI ì‚¬ìš°ë”” ìœ„ì„±ì‚¬ì—…',keyword:'ìš°ì£¼í•­ê³µ'},
  ];
  sr.forEach(item=>{addMRow('rise');const i=rCnt-1;document.getElementById(`rise-rk-${i}`).value=item.rank;document.getElementById(`rise-nm-${i}`).value=item.name;document.getElementById(`rise-rt-${i}`).value=item.rate;document.getElementById(`rise-vl-${i}`).value=item.vol;document.getElementById(`rise-rs-${i}`).value=item.reason;document.getElementById(`rise-kw-${i}`).value=item.keyword;});
  sv.forEach(item=>{addMRow('vol');const i=vCnt-1;document.getElementById(`vol-rk-${i}`).value=item.rank;document.getElementById(`vol-nm-${i}`).value=item.name;document.getElementById(`vol-rt-${i}`).value=item.rate;document.getElementById(`vol-vl-${i}`).value=item.vol;document.getElementById(`vol-rs-${i}`).value=item.reason;document.getElementById(`vol-kw-${i}`).value=item.keyword;});
  toast('ìƒ˜í”Œ ë°ì´í„° ë¡œë“œë¨','info');
}

// â”€â”€ SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateDataStats(){
  const dates=Object.keys(db).sort();
  const el=document.getElementById('dataStats');
  if(el) el.innerHTML=`ì €ì¥ëœ ë‚ ì§œ: ${dates.length}ì¼<br>ìµœì‹ : ${dates[dates.length-1]||'ì—†ìŒ'}<br>ì´ ì¢…ëª©: ${Object.values(db).reduce((a,v)=>a+(v.rise?.length||0)+(v.vol?.length||0),0)}ê°œ`;
}

function exportData(){
  const json=JSON.stringify(db,null,2);
  const blob=new Blob([json],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url; a.download=`stockradar_${toStr(new Date())}.json`; a.click();
  URL.revokeObjectURL(url);
  toast('ğŸ“¤ ë‚´ë³´ë‚´ê¸° ì™„ë£Œ','ok');
}

function clearAll(){
  if(!confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí• ê¹Œìš”?')) return;
  db={}; saveDB();
  toast('ğŸ—‘ ì‚­ì œ ì™„ë£Œ','info');
  loadView();
}

function deleteDay(){
  const date=document.getElementById('viewDate').value;
  if(!date||!db[date]){toast('ì‚­ì œí•  ë°ì´í„° ì—†ìŒ','err');return;}
  if(!confirm(`${date} ì‚­ì œí• ê¹Œìš”?`))return;
  delete db[date]; saveDB(); loadView();
  toast(`ğŸ—‘ ${date} ì‚­ì œ`,'info');
}

// â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function kwTag(kw){
  if(!kw)return '<span class="tag tag-def">-</span>';
  return `<span class="tag tag-${kw.toLowerCase().replace(/[^ê°€-í£a-z0-9]/g,'')}">${kw}</span>`;
}
function toast(msg,type='ok'){
  const el=document.getElementById('toast');
  el.textContent=msg; el.className=`toast ${type} show`;
  clearTimeout(el._t); el._t=setTimeout(()=>el.classList.remove('show'),3000);
}
</script>
</body>
</html>
