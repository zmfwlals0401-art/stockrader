<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>ì£¼ì‹ RADAR</title>
<style>
:root{--bg:#090c12;--s1:#111722;--s2:#181f2e;--border:#1d2638;--up:#ff4560;--up-bg:rgba(255,69,96,.12);--acc:#00c8e8;--acc-bg:rgba(0,200,232,.1);--dn:#26de81;--gold:#ffd32a;--text:#cdd8ea;--dim:#47536a;--dim2:#252f42;}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body{height:100%;background:var(--bg);color:var(--text);font-family:'Noto Sans KR',sans-serif;font-size:14px;overflow-x:hidden;}
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&family=IBM+Plex+Mono:wght@400;700&display=swap');

/* HEADER */
.hd{position:sticky;top:0;z-index:50;background:rgba(9,12,18,.96);border-bottom:1px solid var(--border);padding:10px 14px;display:flex;align-items:center;justify-content:space-between;backdrop-filter:blur(12px);}
.logo{font-weight:900;font-size:16px;letter-spacing:.5px;}<br>.logo em{color:var(--up);font-style:normal;}
.api-dot{width:8px;height:8px;border-radius:50%;background:var(--dim);}
.api-dot.ok{background:var(--dn);box-shadow:0 0 8px var(--dn);}

/* TABS */
.tabs{display:flex;background:var(--s1);border-bottom:1px solid var(--border);}
.tab{flex:1;padding:10px 6px;font-size:12px;font-weight:700;text-align:center;color:var(--dim);border:none;background:none;cursor:pointer;border-bottom:2px solid transparent;transition:all .15s;}
.tab.on{color:var(--up);border-bottom-color:var(--up);}

/* MAIN */
.main{padding:12px;}
.page{display:none;}
.page.on{display:block;}

/* KEY BANNER */
.key-banner{background:linear-gradient(135deg,rgba(255,69,96,.08),rgba(0,200,232,.06));border:1px solid rgba(255,69,96,.25);border-radius:10px;padding:13px;margin-bottom:11px;}
.key-banner.hidden{display:none;}
.key-title{font-size:12px;font-weight:700;color:var(--up);margin-bottom:9px;}
.key-row{display:flex;gap:7px;}
.key-inp{flex:1;font-family:'IBM Plex Mono',monospace;font-size:11px;background:var(--s2);border:1px solid var(--border);border-radius:7px;padding:9px 10px;color:var(--text);outline:none;}
.key-inp:focus{border-color:var(--acc);}
.key-btn{font-family:'Noto Sans KR',sans-serif;font-size:12px;font-weight:700;background:var(--up);color:#fff;border:none;border-radius:7px;padding:9px 16px;cursor:pointer;white-space:nowrap;}
.key-hint{font-size:10px;color:var(--dim);margin-top:8px;line-height:1.7;}
.key-link{color:var(--acc);}

/* ACTION */
.action{background:var(--s1);border:1px solid var(--border);border-radius:10px;padding:10px;margin-bottom:10px;}
.arow{display:flex;gap:7px;margin-bottom:7px;}
.arow:last-child{margin-bottom:0;}
.date-inp{flex:1;font-family:'IBM Plex Mono',monospace;font-size:13px;background:var(--s2);border:1px solid var(--border);border-radius:7px;padding:9px 10px;color:var(--text);outline:none;}
.date-inp:focus{border-color:var(--acc);}
.btn{font-family:'Noto Sans KR',sans-serif;font-size:12px;font-weight:700;padding:9px 14px;border-radius:7px;border:none;cursor:pointer;display:flex;align-items:center;gap:4px;white-space:nowrap;min-height:40px;}
.btn-up{background:var(--up);color:#fff;}
.btn-up:active{background:#d83050;}
.btn-acc{background:var(--acc-bg);color:var(--acc);border:1px solid rgba(0,200,232,.3);}
.btn-ghost{background:var(--s2);color:var(--dim);border:1px solid var(--border);}
.btn:disabled{opacity:.35;}
.ameta{font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--dim);text-align:center;margin-top:4px;}

/* STATS */
.sgrid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px;}
.sbox{background:var(--s1);border:1px solid var(--border);border-radius:10px;padding:10px 12px;border-left:3px solid var(--border);}
.sbox.r{border-left-color:var(--up);}
.sbox.b{border-left-color:var(--acc);}
.sbox.g{border-left-color:var(--dn);}
.sbox.o{border-left-color:var(--gold);}
.slbl{font-size:9px;font-weight:700;color:var(--dim);letter-spacing:.6px;text-transform:uppercase;margin-bottom:4px;}
.sval{font-family:'IBM Plex Mono',monospace;font-size:16px;font-weight:700;}
.sval.r{color:var(--up);}
.sval.b{color:var(--acc);}
.sval.g{color:var(--dn);}
.sval.o{color:var(--gold);}
.sval.sm{font-size:11px;color:var(--text);}

/* SECTION */
.sec{margin-bottom:10px;}
.sec-hd{display:flex;align-items:center;justify-content:space-between;padding:9px 12px;background:var(--s2);border:1px solid var(--border);border-bottom:none;border-radius:10px 10px 0 0;}
.sec-title{font-size:12px;font-weight:700;display:flex;align-items:center;gap:5px;}
.badge{font-size:8px;font-weight:700;padding:2px 5px;border-radius:2px;letter-spacing:.4px;text-transform:uppercase;}
.badge-r{background:var(--up-bg);color:var(--up);}
.badge-b{background:var(--acc-bg);color:var(--acc);}
.badge-g{background:rgba(38,222,129,.1);color:var(--dn);}
.badge-p{background:rgba(165,94,234,.1);color:#b48be8;}
.sec-meta{font-family:'IBM Plex Mono',monospace;font-size:9px;color:var(--dim);}

/* STOCK LIST */
.slist{background:var(--s1);border:1px solid var(--border);border-radius:0 0 10px 10px;overflow:hidden;}
.sitem{display:flex;align-items:center;gap:9px;padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.025);}
.sitem:last-child{border-bottom:none;}
.srk{font-family:'IBM Plex Mono',monospace;font-size:11px;font-weight:700;color:var(--dim2);width:20px;text-align:center;flex-shrink:0;}
.srk.g1{color:var(--gold);}
.srk.g2{color:#a0aab8;}
.srk.g3{color:#8a6848;}
.sinfo{flex:1;min-width:0;}
.snm{font-size:13px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.srs{font-size:10px;color:var(--dim);margin-top:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.sright{display:flex;flex-direction:column;align-items:flex-end;gap:3px;flex-shrink:0;}
.srt{font-family:'IBM Plex Mono',monospace;font-size:13px;font-weight:700;color:var(--up);}
.srt.lim{color:#ff6b81;}
.svl{font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--acc);}

/* TAG */
.tag{display:inline-block;font-size:9px;font-weight:700;padding:2px 5px;border-radius:2px;white-space:nowrap;}
.tag-ì¦ê¶Œ{background:rgba(255,69,96,.12);color:#ff6b81;}
.tag-ì œì•½ë°”ì´ì˜¤{background:rgba(38,222,129,.12);color:#69db7c;}
.tag-ë°˜ë„ì²´{background:rgba(0,200,232,.12);color:var(--acc);}
.tag-ìš°ì£¼í•­ê³µ{background:rgba(165,94,234,.12);color:#c084fc;}
.tag-ì›ì „{background:rgba(255,211,42,.12);color:var(--gold);}
.tag-skê·¸ë£¹{background:rgba(255,69,96,.1);color:#ff8fa3;}
.tag-ì§€ì£¼ì‚¬{background:rgba(120,130,150,.12);color:#9ca3af;}
.tag-ë¡œë´‡{background:rgba(0,200,232,.1);color:#67e8f9;}
.tag-ë°©ì‚°{background:rgba(255,211,42,.1);color:var(--gold);}
.tag-ë‚¨ë¶ê²½í˜‘{background:rgba(100,180,255,.1);color:#93c5fd;}
.tag-2ì°¨ì „ì§€{background:rgba(38,222,129,.1);color:#86efac;}
.tag-íƒœì–‘ê´‘{background:rgba(255,211,42,.08);color:#fde047;}
.tag-ìë™ì°¨{background:rgba(255,159,67,.1);color:#fdba74;}
.tag-í†µì‹ {background:rgba(100,149,237,.1);color:#93b4f5;}
.tag-ê°œë³„ì´ìŠˆ{background:rgba(100,110,130,.1);color:#6b7280;}
.tag-def{background:rgba(80,90,110,.1);color:#6b7280;}

/* KW */
.kwlist{background:var(--s1);border:1px solid var(--border);border-radius:0 0 10px 10px;padding:10px 12px;}
.kwrow{display:flex;align-items:center;gap:6px;margin-bottom:5px;}
.kwrow:last-child{margin-bottom:0;}
.kwi{font-family:'IBM Plex Mono',monospace;font-size:9px;color:var(--dim2);width:12px;text-align:right;flex-shrink:0;}
.kwbg{flex:1;height:4px;background:var(--s2);border-radius:2px;overflow:hidden;}
.kwfill{height:100%;border-radius:2px;background:var(--up);}
.kwcnt{font-family:'IBM Plex Mono',monospace;font-size:9px;color:var(--dim);width:18px;text-align:right;flex-shrink:0;}
.kwvol{font-family:'IBM Plex Mono',monospace;font-size:9px;color:var(--acc);width:55px;text-align:right;flex-shrink:0;}

/* CALENDAR */
.calnav{display:flex;align-items:center;gap:8px;padding:10px 12px;background:var(--s1);border:1px solid var(--border);border-radius:10px 10px 0 0;border-bottom:none;}
.calbtn{width:32px;height:32px;border-radius:7px;border:1px solid var(--border);background:var(--s2);color:var(--text);font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;}
.calmonth{font-family:'IBM Plex Mono',monospace;font-size:14px;font-weight:700;flex:1;text-align:center;}
.calgrid-hd{display:grid;grid-template-columns:repeat(5,1fr);}
.calhd{padding:7px 4px;text-align:center;font-family:'IBM Plex Mono',monospace;font-size:9px;font-weight:700;color:var(--dim);background:var(--s2);border:1px solid var(--border);border-top:none;}
.calhd.mon{color:var(--up);}
.calhd.fri{color:var(--acc);}
.calbody{display:grid;grid-template-columns:repeat(5,1fr);border:1px solid var(--border);border-top:none;border-radius:0 0 10px 10px;overflow:hidden;}
.calcell{border-right:1px solid var(--border);border-bottom:1px solid var(--border);min-height:80px;padding:6px;background:var(--s1);}
.calcell:nth-child(5n){border-right:none;}
.calcell.empty{background:rgba(0,0,0,.25);}
.calcell.has{border-top:2px solid var(--up);cursor:pointer;}
.calcell.has:active{background:rgba(255,69,96,.04);}
.cald{font-family:'IBM Plex Mono',monospace;font-size:10px;font-weight:700;color:var(--dim);margin-bottom:4px;}
.calkwnm{font-size:9px;font-weight:700;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.calkwvl{font-family:'IBM Plex Mono',monospace;font-size:8px;color:var(--acc);}

/* INPUT */
.insec{background:var(--s1);border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:10px;}
.inshd{padding:10px 12px;background:var(--s2);border-bottom:1px solid var(--border);font-size:12px;font-weight:700;display:flex;align-items:center;justify-content:space-between;}
.initems{padding:8px;display:flex;flex-direction:column;gap:6px;}
.initem{background:var(--s2);border:1px solid var(--border);border-radius:7px;padding:9px;}
.inrow1{display:grid;grid-template-columns:48px 1fr 68px 68px;gap:5px;margin-bottom:5px;}
.inrow2{display:grid;grid-template-columns:1fr 95px 28px;gap:5px;}
.minp{font-family:'Noto Sans KR',sans-serif;font-size:12px;background:var(--bg);border:1px solid var(--border);border-radius:5px;padding:7px 8px;color:var(--text);outline:none;width:100%;}
.minp:focus{border-color:var(--acc);}
.minp::placeholder{color:var(--dim2);font-size:11px;}
.msel{font-family:'Noto Sans KR',sans-serif;font-size:11px;background:var(--bg);border:1px solid var(--border);border-radius:5px;padding:7px 3px;color:var(--text);outline:none;width:100%;}
.mlbl{font-size:9px;color:var(--dim);margin-bottom:2px;}
.rmbtn{background:none;border:1px solid var(--border);border-radius:5px;color:var(--dim);cursor:pointer;width:28px;height:100%;display:flex;align-items:center;justify-content:center;font-size:13px;}

/* AI */
.aibox{background:rgba(0,200,232,.05);border:1px solid rgba(0,200,232,.2);border-radius:10px;padding:20px;text-align:center;display:flex;flex-direction:column;align-items:center;gap:10px;}
.aitxt{font-size:12px;color:var(--acc);}
.dots{display:flex;gap:5px;justify-content:center;}
.dot{width:6px;height:6px;border-radius:50%;background:var(--acc);animation:bounce .8s ease-in-out infinite;}
.dot:nth-child(2){animation-delay:.15s;}
.dot:nth-child(3){animation-delay:.3s;}
@keyframes bounce{0%,80%,100%{transform:translateY(0)}40%{transform:translateY(-7px)}}

/* MODAL */
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:200;align-items:flex-end;}
.overlay.on{display:flex;}
.sheet{background:var(--s1);border-radius:18px 18px 0 0;width:100%;max-height:88vh;overflow:hidden;display:flex;flex-direction:column;border-top:1px solid var(--border);}
.sheet-hd{padding:14px 16px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);}
.sheet-handle{width:36px;height:4px;border-radius:2px;background:var(--border);margin:8px auto 0;}
.sheet-title{font-size:14px;font-weight:700;}
.sheet-x{background:none;border:none;color:var(--dim);font-size:18px;cursor:pointer;padding:4px;}
.sheet-body{overflow-y:auto;padding:12px;flex:1;-webkit-overflow-scrolling:touch;}

/* EMPTY */
.empty{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:36px;gap:8px;}
.eico{font-size:30px;}
.emsg{font-size:13px;color:var(--dim);text-align:center;}
.esub{font-size:11px;color:var(--dim2);text-align:center;}

/* TOAST */
.toast{position:fixed;bottom:16px;left:12px;right:12px;z-index:300;padding:12px 16px;border-radius:10px;font-size:13px;font-weight:700;text-align:center;opacity:0;transition:opacity .2s;pointer-events:none;}
.toast.ok{background:var(--dn);color:#000;}
.toast.err{background:var(--up);color:#fff;}
.toast.info{background:var(--acc);color:#000;}
.toast.show{opacity:1;}

/* SETTINGS */
.setsec{background:var(--s1);border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:10px;}
.sethd{padding:10px 12px;background:var(--s2);border-bottom:1px solid var(--border);font-size:12px;font-weight:700;}
.setbody{padding:12px;display:flex;flex-direction:column;gap:10px;}
.setlbl{font-size:10px;color:var(--dim);margin-bottom:3px;letter-spacing:.3px;}
.sethint{font-size:11px;color:var(--dim);line-height:1.8;}
</style>
</head>
<body>

<div class="hd">
  <div class="logo"><em>ì£¼ì‹</em>RADAR ğŸ“¡</div>
  <div style="display:flex;align-items:center;gap:8px;">
    <div style="font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--dim)" id="clock"></div>
    <div class="api-dot" id="apiDot"></div>
  </div>
</div>

<div class="tabs">
  <button class="tab on" onclick="goTab('daily',this)">ğŸ“… ì¼ê°„</button>
  <button class="tab" onclick="goTab('monthly',this)">ğŸ“† ì›”ê°„</button>
  <button class="tab" onclick="goTab('input',this)">âœï¸ ì…ë ¥</button>
  <button class="tab" onclick="goTab('settings',this)">âš™ï¸ ì„¤ì •</button>
</div>

<div class="main">

<!-- ì¼ê°„ -->
<div id="page-daily" class="page on">
  <div class="key-banner" id="keyBanner">
    <div class="key-title">âš¡ Claude API í‚¤ ì…ë ¥ (ìµœì´ˆ 1íšŒ)</div>
    <div class="key-row">
      <input class="key-inp" id="keyInp" type="password" placeholder="sk-ant-api03-...">
      <button class="key-btn" onclick="saveKey()">ì €ì¥</button>
    </div>
    <div class="key-hint">
      ğŸ‘‰ <a class="key-link" href="https://console.anthropic.com" target="_blank">console.anthropic.com</a> â†’ êµ¬ê¸€ íšŒì›ê°€ì… â†’ API Keys â†’ Create Key<br>
      ğŸ”’ í‚¤ëŠ” ì´ ê¸°ê¸°ì—ë§Œ ì €ì¥ Â· í•˜ë£¨ 1íšŒ ìˆ˜ì§‘ ì‹œ ì›” ì•½ 500ì›
    </div>
  </div>

  <div class="action">
    <div class="arow">
      <input type="date" class="date-inp" id="collectDate">
      <button class="btn btn-up" id="btnAI" onclick="aiCollect()">ğŸ¤– AIìˆ˜ì§‘</button>
    </div>
    <div class="arow">
      <input type="date" class="date-inp" id="viewDate" onchange="loadView()">
      <button class="btn btn-acc" onclick="loadView()">ì¡°íšŒ</button>
      <button class="btn btn-ghost" onclick="deleteDay()">ğŸ—‘</button>
    </div>
    <div class="ameta" id="ameta">ë‚ ì§œ ì„ íƒ í›„ AIìˆ˜ì§‘ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”</div>
  </div>
  <div id="dailyContent">
    <div class="empty"><div class="eico">ğŸ“¡</div><div class="emsg">ë‚ ì§œë¥¼ ì„ íƒí•˜ê³ <br>AIìˆ˜ì§‘ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</div></div>
  </div>
</div>

<!-- ì›”ê°„ -->
<div id="page-monthly" class="page">
  <div style="margin-bottom:10px;">
    <div class="calnav">
      <button class="calbtn" onclick="chMonth(-1)">â€¹</button>
      <div class="calmonth" id="calMonth"></div>
      <button class="calbtn" onclick="chMonth(1)">â€º</button>
    </div>
    <div class="calgrid-hd">
      <div class="calhd mon">ì›”</div><div class="calhd">í™”</div><div class="calhd">ìˆ˜</div><div class="calhd">ëª©</div><div class="calhd fri">ê¸ˆ</div>
    </div>
    <div class="calbody" id="calBody"></div>
  </div>
  <div class="sec">
    <div class="sec-hd"><div class="sec-title">ğŸ·ï¸ ì›”ê°„ í‚¤ì›Œë“œ <span class="badge badge-p">MONTHLY</span></div></div>
    <div class="kwlist" id="kwMonthly"></div>
  </div>
</div>

<!-- ìˆ˜ë™ì…ë ¥ -->
<div id="page-input" class="page">
  <div style="display:flex;gap:8px;margin-bottom:10px;">
    <input type="date" class="date-inp" id="manDate" style="flex:1;">
    <button class="btn btn-ghost" onclick="loadSample()" style="font-size:11px;">ìƒ˜í”Œ</button>
  </div>
  <div class="insec">
    <div class="inshd"><span style="color:var(--up)">â–² ìƒìŠ¹ë¥  TOP</span><button onclick="addRow('rise')" style="font-size:11px;background:none;border:none;color:var(--acc);font-weight:700;cursor:pointer;">+ ì¶”ê°€</button></div>
    <div class="initems" id="riseItems"></div>
  </div>
  <div class="insec">
    <div class="inshd"><span style="color:var(--acc)">â— ê±°ë˜ëŒ€ê¸ˆ</span><button onclick="addRow('vol')" style="font-size:11px;background:none;border:none;color:var(--acc);font-weight:700;cursor:pointer;">+ ì¶”ê°€</button></div>
    <div class="initems" id="volItems"></div>
  </div>
  <div style="display:flex;gap:8px;">
    <button class="btn btn-up" style="flex:1;" onclick="saveManual()">ğŸ’¾ ì €ì¥</button>
    <button class="btn btn-ghost" onclick="clearManual()">ì´ˆê¸°í™”</button>
  </div>
</div>

<!-- ì„¤ì • -->
<div id="page-settings" class="page">
  <div class="setsec">
    <div class="sethd">âš™ï¸ API í‚¤ ì„¤ì •</div>
    <div class="setbody">
      <div><div class="setlbl">Claude API Key</div><input class="minp" id="setKey" type="password" placeholder="sk-ant-api03-..."></div>
      <button class="btn btn-up" style="width:100%;justify-content:center;" onclick="saveKeySet()">ì €ì¥</button>
      <div class="sethint">
        ğŸ“Œ í‚¤ ë°œê¸‰ ë°©ë²•:<br>
        1. <a href="https://console.anthropic.com" target="_blank" style="color:var(--acc);">console.anthropic.com</a> ì ‘ì†<br>
        2. êµ¬ê¸€ë¡œ íšŒì›ê°€ì…<br>
        3. ì™¼ìª½ ë©”ë‰´ "API Keys" í´ë¦­<br>
        4. "Create Key" ë²„íŠ¼ í´ë¦­<br>
        5. ìƒì„±ëœ í‚¤ ë³µì‚¬ í›„ ìœ„ì— ë¶™ì—¬ë„£ê¸°
      </div>
    </div>
  </div>
  <div class="setsec">
    <div class="sethd">ğŸ“Š ì €ì¥ ë°ì´í„°</div>
    <div class="setbody">
      <div class="sethint" id="dataInfo"></div>
      <button class="btn btn-ghost" style="width:100%;justify-content:center;font-size:11px;" onclick="exportJSON()">ğŸ“¤ JSON ë‚´ë³´ë‚´ê¸°</button>
      <button class="btn btn-ghost" style="width:100%;justify-content:center;font-size:11px;color:var(--up);border-color:var(--up)" onclick="clearAll()">ğŸ—‘ ì „ì²´ ì‚­ì œ</button>
    </div>
  </div>
</div>

</div><!-- /main -->

<!-- ë°”í…€ì‹œíŠ¸ ëª¨ë‹¬ -->
<div class="overlay" id="overlay" onclick="closeSheet(event)">
  <div class="sheet">
    <div class="sheet-handle"></div>
    <div class="sheet-hd">
      <div class="sheet-title" id="sheetTitle"></div>
      <button class="sheet-x" onclick="closeSheet()">âœ•</button>
    </div>
    <div class="sheet-body" id="sheetBody"></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DB='sr3'; let db={};
try{db=JSON.parse(localStorage.getItem(DB))||{};}catch{db={};}
function save(){try{localStorage.setItem(DB,JSON.stringify(db));}catch{toast('ì €ì¥ ì‹¤íŒ¨','err');}}
function getK(){return localStorage.getItem('sr_k')||'';}
let cm=new Date(),rC=0,vC=0;

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('DOMContentLoaded',()=>{
  const t=toStr(new Date());
  ['collectDate','viewDate','manDate'].forEach(id=>{const el=document.getElementById(id);if(el)el.value=t;});
  setInterval(()=>{document.getElementById('clock').textContent=new Date().toLocaleTimeString('ko',{hour:'2-digit',minute:'2-digit'});},1000);
  initKey(); addRow('rise'); addRow('vol'); loadView();
});

function pad(n){return String(n).padStart(2,'0');}
function toStr(d){return d.toISOString().slice(0,10);}

function initKey(){
  const k=getK(),dot=document.getElementById('apiDot'),banner=document.getElementById('keyBanner');
  if(k){dot.className='api-dot ok';if(banner)banner.classList.add('hidden');}
  else{dot.className='api-dot';if(banner)banner.classList.remove('hidden');}
  const sk=document.getElementById('setKey');if(sk)sk.value=k;
}

// â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function goTab(id,btn){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('on'));
  document.querySelectorAll('.tab').forEach(b=>b.classList.remove('on'));
  document.getElementById('page-'+id).classList.add('on');
  btn.classList.add('on');
  if(id==='monthly')renderCal();
  if(id==='settings')updateInfo();
}

// â”€â”€ KEY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveKey(){
  const k=document.getElementById('keyInp').value.trim();
  if(!k.startsWith('sk-ant-')){toast('í‚¤ í˜•ì‹ì´ ì˜ëª»ëì–´ìš” (sk-ant-...ë¡œ ì‹œì‘)','err');return;}
  localStorage.setItem('sr_k',k); initKey(); toast('âœ… API í‚¤ ì €ì¥ ì™„ë£Œ!','ok');
}
function saveKeySet(){
  const k=document.getElementById('setKey').value.trim();
  if(!k.startsWith('sk-ant-')){toast('í‚¤ í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”','err');return;}
  localStorage.setItem('sr_k',k); initKey(); toast('âœ… ì €ì¥ ì™„ë£Œ!','ok');
}

// â”€â”€ AI COLLECT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function aiCollect(){
  const k=getK();
  if(!k){document.getElementById('keyBanner').classList.remove('hidden');document.getElementById('keyInp').focus();toast('API í‚¤ë¥¼ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”','err');return;}
  const date=document.getElementById('collectDate').value;
  if(!date){toast('ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”','err');return;}
  const btn=document.getElementById('btnAI');
  btn.disabled=true;btn.textContent='ìˆ˜ì§‘ ì¤‘...';
  document.getElementById('dailyContent').innerHTML=`<div class="aibox"><div class="dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div><div class="aitxt">Claude AIê°€ ${date}<br>ì£¼ì‹ ë°ì´í„°ë¥¼ ë¶„ì„ ì¤‘ì´ì—ìš”...</div></div>`;
  try{
    const r=await fetchClaude(date,k);
    db[date]=r; save();
    document.getElementById('viewDate').value=date;
    renderDay(date,r);
    toast(`âœ… ${date} ìˆ˜ì§‘ ì™„ë£Œ!`,'ok');
  }catch(e){
    document.getElementById('dailyContent').innerHTML=`<div class="empty"><div class="eico">âŒ</div><div class="emsg">ìˆ˜ì§‘ ì‹¤íŒ¨</div><div class="esub">${e.message}</div></div>`;
    toast('ì‹¤íŒ¨: '+e.message,'err');
  }finally{btn.disabled=false;btn.innerHTML='ğŸ¤– AIìˆ˜ì§‘';}
}

async function fetchClaude(date,apiKey){
  const prompt=`í•œêµ­ ì£¼ì‹ ì „ë¬¸ê°€ë¡œì„œ ${date}ì˜ ì½”ìŠ¤í”¼+ì½”ìŠ¤ë‹¥ ì‹œì¥ ë°ì´í„°ë¥¼ ìƒì„±í•˜ì„¸ìš”.
í•´ë‹¹ ë‚ ì§œ ì „í›„ ì‹¤ì œ ì‹œì¥ íŠ¸ë Œë“œë¥¼ ìµœëŒ€í•œ ë°˜ì˜í•œ í˜„ì‹¤ì  ë°ì´í„°ë¥¼ ë§Œë“œì„¸ìš”.
JSONë§Œ ì¶œë ¥:
{"rise":[{"rank":1,"name":"ì¢…ëª©ëª…","rate":29.95,"vol":3461,"reason":"ì´ìœ 30ìì´ë‚´","keyword":"í‚¤ì›Œë“œ"},...30ê°œ],"vol":[{"rank":1,"name":"ì¢…ëª©ëª…","rate":14.42,"vol":24603,"reason":"ì´ìœ ","keyword":"í‚¤ì›Œë“œ"},...30ê°œ]}
keywordëŠ” ë°˜ë“œì‹œ: ì¦ê¶Œ,ì œì•½ë°”ì´ì˜¤,ë°˜ë„ì²´,ìš°ì£¼í•­ê³µ,ì›ì „,SKê·¸ë£¹,ì§€ì£¼ì‚¬,ë¡œë´‡,ë°©ì‚°,ë‚¨ë¶ê²½í˜‘,2ì°¨ì „ì§€,íƒœì–‘ê´‘,ìë™ì°¨,í†µì‹ ,ê°œë³„ì´ìŠˆ ì¤‘ í•˜ë‚˜
rise[0].rate=25~30%, vol[0].vol=15000~30000ì–µ, í˜„ì‹¤ì  í•œêµ­ ì¢…ëª©ëª… ì‚¬ìš©`;
  const res=await fetch('https://api.anthropic.com/v1/messages',{
    method:'POST',
    headers:{'Content-Type':'application/json','x-api-key':apiKey,'anthropic-version':'2023-06-01'},
    body:JSON.stringify({model:'claude-opus-4-6',max_tokens:4000,messages:[{role:'user',content:prompt}]})
  });
  if(!res.ok){const e=await res.json().catch(()=>({}));throw new Error(e.error?.message||`ì˜¤ë¥˜ ${res.status}`);}
  const d=await res.json();
  const txt=d.content[0]?.text||'';
  const m=txt.match(/\{[\s\S]*\}/);
  if(!m)throw new Error('ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨');
  const p=JSON.parse(m[0]);
  if(!p.rise?.length)throw new Error('ë°ì´í„° ì—†ìŒ');
  return p;
}

// â”€â”€ VIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadView(){
  const date=document.getElementById('viewDate').value;
  const data=db[date];
  if(!data){
    document.getElementById('dailyContent').innerHTML=`<div class="empty"><div class="eico">ğŸ“­</div><div class="emsg">${date||'ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”'}</div><div class="esub">ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div></div>`;
    document.getElementById('ameta').textContent='ë°ì´í„° ì—†ìŒ';return;
  }
  renderDay(date,data);
}

function renderDay(date,data){
  const{rise=[],vol=[]}=data;
  document.getElementById('ameta').textContent=`${date} Â· ìƒìŠ¹ë¥  ${rise.length} Â· ê±°ë˜ëŒ€ê¸ˆ ${vol.length}`;
  const avg=rise.length?(rise.reduce((a,b)=>a+b.rate,0)/rise.length).toFixed(1):0;
  const totV=vol.reduce((a,b)=>a+(b.vol||0),0);
  const kf={};[...rise,...vol].forEach(s=>{if(s.keyword)kf[s.keyword]=(kf[s.keyword]||0)+1;});
  const tk=Object.entries(kf).sort((a,b)=>b[1]-a[1])[0];
  const integ=buildInteg(rise,vol);
  document.getElementById('dailyContent').innerHTML=`
    <div class="sgrid">
      <div class="sbox r"><div class="slbl">í‰ê·  ìƒìŠ¹ë¥ </div><div class="sval r">+${avg}%</div></div>
      <div class="sbox r"><div class="slbl">ìµœê³  ìƒìŠ¹</div><div class="sval sm">${rise[0]?.name||'-'} +${rise[0]?.rate||0}%</div></div>
      <div class="sbox b"><div class="slbl">ì´ ê±°ë˜ëŒ€ê¸ˆ</div><div class="sval b">${totV.toLocaleString()}ì–µ</div></div>
      <div class="sbox o"><div class="slbl">í•µì‹¬ í‚¤ì›Œë“œ</div><div class="sval sm" style="color:var(--gold)">${tk?tk[0]+' '+tk[1]+'ê±´':'-'}</div></div>
    </div>
    ${buildList('ğŸ“ˆ ìƒìŠ¹ë¥  TOP',rise,'badge-r','TOP30')}
    ${buildList('ğŸ’° ê±°ë˜ëŒ€ê¸ˆ ì£¼ë„ì£¼',vol,'badge-b','ê±°ë˜ëŒ€ê¸ˆ')}
    ${buildList('ğŸ”€ 1Â·2ë‹¨ê³„ í†µí•©ì •ë¦¬',integ,'badge-g','í†µí•©',true)}
    ${buildKw(rise,vol)}`;
}

function buildList(title,stocks,bc,bt,integ=false){
  const items=stocks.length?stocks.map((s,i)=>`
    <div class="sitem">
      <div class="srk ${i===0?'g1':i===1?'g2':i===2?'g3':''}">${s.rank||i+1}</div>
      <div class="sinfo"><div class="snm">${s.name}</div><div class="srs">${s.reason||''}</div></div>
      <div class="sright">
        <div class="srt ${s.rate>=29.5?'lim':''}">${s.rate>=0?'+':''}${s.rate}%</div>
        <div class="svl">${s.vol?s.vol.toLocaleString()+'ì–µ':''}</div>
        <div>${kwTag(s.keyword)}</div>
      </div>
    </div>`).join(''):`<div class="empty" style="padding:18px"><div class="emsg">ë°ì´í„° ì—†ìŒ</div></div>`;
  return `<div class="sec"><div class="sec-hd"><div class="sec-title">${title} <span class="badge ${bc}">${bt}</span></div><span class="sec-meta">${stocks.length}ì¢…ëª©</span></div><div class="slist">${items}</div></div>`;
}

function buildInteg(rise,vol){
  const m={};
  rise.forEach(s=>{m[s.name]={...s,_s:'rise'};});
  vol.forEach(s=>{if(m[s.name]){m[s.name].vol=s.vol;m[s.name]._s='both';}else m[s.name]={...s,_s:'vol'};});
  return Object.values(m).sort((a,b)=>(a.keyword||'').localeCompare(b.keyword||'')||b.rate-a.rate).map((s,i)=>({...s,rank:i+1}));
}

function buildKw(rise,vol){
  const kf={},kv={};
  [...rise,...vol].forEach(s=>{if(!s.keyword)return;kf[s.keyword]=(kf[s.keyword]||0)+1;kv[s.keyword]=(kv[s.keyword]||0)+(s.vol||0);});
  const e=Object.entries(kf).sort((a,b)=>b[1]-a[1]);
  if(!e.length)return '';
  const mx=e[0][1];
  const rows=e.map(([kw,cnt],i)=>`<div class="kwrow"><span class="kwi">${i+1}</span>${kwTag(kw)}<div class="kwbg"><div class="kwfill" style="width:${(cnt/mx*100).toFixed(0)}%"></div></div><span class="kwcnt">${cnt}</span><span class="kwvol">${(kv[kw]||0).toLocaleString()}ì–µ</span></div>`).join('');
  return `<div class="sec"><div class="sec-hd"><div class="sec-title">ğŸ·ï¸ í‚¤ì›Œë“œ ë¶„ì„ <span class="badge badge-p">KEYWORD</span></div></div><div class="kwlist">${rows}</div></div>`;
}

// â”€â”€ CALENDAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderCal(){
  const y=cm.getFullYear(),m=cm.getMonth();
  document.getElementById('calMonth').textContent=`${y}ë…„ ${m+1}ì›”`;
  const fw=new Date(y,m,1).getDay(),days=new Date(y,m+1,0).getDate(),off=fw===0?6:fw-1;
  let html='';
  for(let e=0;e<off%5;e++)html+=`<div class="calcell empty"></div>`;
  for(let d=1;d<=days;d++){
    const wd=new Date(y,m,d).getDay();if(wd===0||wd===6)continue;
    const ds=`${y}-${pad(m+1)}-${pad(d)}`,dd=db[ds],has=!!dd;
    let kwh='';
    if(has){
      const kf={},kv={};
      [...(dd.rise||[]),...(dd.vol||[])].forEach(s=>{if(!s.keyword)return;kf[s.keyword]=(kf[s.keyword]||0)+1;kv[s.keyword]=(kv[s.keyword]||0)+(s.vol||0);});
      kwh=Object.entries(kf).sort((a,b)=>b[1]-a[1]).slice(0,3).map(([kw])=>`<div class="calkwnm">${kw}</div>`).join('');
    }
    html+=`<div class="calcell ${has?'has':''}" ${has?`onclick="showSheet('${ds}')"`:''}><div class="cald">${d}</div>${kwh}</div>`;
  }
  document.getElementById('calBody').innerHTML=html;
  // monthly kw
  const prefix=`${y}-${pad(m+1)}`;
  const kf={},kv={};
  Object.entries(db).filter(([k])=>k.startsWith(prefix)).forEach(([,v])=>{
    [...(v.rise||[]),...(v.vol||[])].forEach(s=>{if(!s.keyword)return;kf[s.keyword]=(kf[s.keyword]||0)+1;kv[s.keyword]=(kv[s.keyword]||0)+(s.vol||0);});
  });
  const e=Object.entries(kf).sort((a,b)=>b[1]-a[1]);const mx=e[0]?.[1]||1;
  document.getElementById('kwMonthly').innerHTML=e.length
    ?e.map(([kw,cnt],i)=>`<div class="kwrow"><span class="kwi">${i+1}</span>${kwTag(kw)}<div class="kwbg"><div class="kwfill" style="width:${(cnt/mx*100).toFixed(0)}%"></div></div><span class="kwcnt">${cnt}</span><span class="kwvol">${(kv[kw]||0).toLocaleString()}ì–µ</span></div>`).join('')
    :`<div class="empty" style="padding:18px"><div class="emsg">ì´ë²ˆ ë‹¬ ë°ì´í„° ì—†ìŒ</div></div>`;
}
function chMonth(d){cm.setMonth(cm.getMonth()+d);renderCal();}

// â”€â”€ SHEET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showSheet(date){
  const data=db[date];if(!data)return;
  document.getElementById('sheetTitle').textContent=`ğŸ“… ${date}`;
  const integ=buildInteg(data.rise||[],data.vol||[]);
  document.getElementById('sheetBody').innerHTML=
    buildList('ğŸ“ˆ ìƒìŠ¹ë¥ ',data.rise||[],'badge-r','TOP')+
    buildList('ğŸ’° ê±°ë˜ëŒ€ê¸ˆ',data.vol||[],'badge-b','ëŒ€ê¸ˆ')+
    buildList('ğŸ”€ í†µí•©',integ,'badge-g','í†µí•©');
  document.getElementById('overlay').classList.add('on');
}
function closeSheet(e){if(!e||e.target===document.getElementById('overlay'))document.getElementById('overlay').classList.remove('on');}

// â”€â”€ MANUAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const KWS=['ì¦ê¶Œ','ì œì•½ë°”ì´ì˜¤','ë°˜ë„ì²´','ìš°ì£¼í•­ê³µ','ì›ì „','SKê·¸ë£¹','ì§€ì£¼ì‚¬','ë¡œë´‡','ë°©ì‚°','ë‚¨ë¶ê²½í˜‘','2ì°¨ì „ì§€','íƒœì–‘ê´‘','ìë™ì°¨','í†µì‹ ','ê°œë³„ì´ìŠˆ'];
function addRow(type){
  const idx=type==='rise'?rC++:vC++;
  const opts=KWS.map(k=>`<option value="${k}">${k}</option>`).join('');
  const el=document.createElement('div');
  el.innerHTML=`<div class="initem" id="${type}-i-${idx}">
    <div class="inrow1">
      <div><div class="mlbl">ìˆœìœ„</div><input class="minp" type="number" id="${type}-rk-${idx}" value="${idx+1}"></div>
      <div><div class="mlbl">ì¢…ëª©ëª…</div><input class="minp" type="text" id="${type}-nm-${idx}" placeholder="ì¢…ëª©ëª…"></div>
      <div><div class="mlbl">ë“±ë½%</div><input class="minp" type="number" step="0.01" id="${type}-rt-${idx}" placeholder="29.95"></div>
      <div><div class="mlbl">ê±°ë˜(ì–µ)</div><input class="minp" type="number" id="${type}-vl-${idx}" placeholder="3461"></div>
    </div>
    <div class="inrow2">
      <div><div class="mlbl">ì´ìœ </div><input class="minp" type="text" id="${type}-rs-${idx}" placeholder="ìƒìŠ¹ì´ìœ "></div>
      <div><div class="mlbl">í‚¤ì›Œë“œ</div><select class="msel" id="${type}-kw-${idx}"><option value="">-</option>${opts}</select></div>
      <button class="rmbtn" onclick="document.getElementById('${type}-i-${idx}').remove()">âœ•</button>
    </div>
  </div>`;
  document.getElementById(type+'Items').appendChild(el.firstElementChild);
}
function collectR(type){
  return Array.from(document.querySelectorAll(`[id^="${type}-i-"]`)).map(row=>{
    const i=row.id.replace(type+'-i-','');
    const nm=document.getElementById(`${type}-nm-${i}`)?.value?.trim();
    if(!nm)return null;
    return{rank:parseInt(document.getElementById(`${type}-rk-${i}`)?.value)||0,name:nm,
      rate:parseFloat(document.getElementById(`${type}-rt-${i}`)?.value)||0,
      vol:parseInt(document.getElementById(`${type}-vl-${i}`)?.value)||0,
      reason:document.getElementById(`${type}-rs-${i}`)?.value?.trim()||'',
      keyword:document.getElementById(`${type}-kw-${i}`)?.value||''};
  }).filter(Boolean).sort((a,b)=>a.rank-b.rank);
}
function saveManual(){
  const date=document.getElementById('manDate').value;
  if(!date){toast('ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”','err');return;}
  const rise=collectR('rise'),vol=collectR('vol');
  if(!rise.length&&!vol.length){toast('ì¢…ëª©ì„ ì…ë ¥í•˜ì„¸ìš”','err');return;}
  db[date]={rise,vol};save();
  document.getElementById('viewDate').value=date;
  toast(`âœ… ${date} ì €ì¥!`,'ok');
}
function clearManual(){document.getElementById('riseItems').innerHTML='';document.getElementById('volItems').innerHTML='';rC=0;vC=0;addRow('rise');addRow('vol');}
function loadSample(){
  document.getElementById('manDate').value='2026-02-13';
  document.getElementById('riseItems').innerHTML='';document.getElementById('volItems').innerHTML='';rC=0;vC=0;
  [{rank:1,name:'SKì¦ê¶Œ',rate:29.95,vol:3461,reason:'ë°¸ë¥˜ì—… ê¸°ëŒ€+ì‹¤ì ê°œì„ ',keyword:'ì¦ê¶Œ'},{rank:2,name:'ìœ íˆ¬ë°”ì´ì˜¤',rate:29.94,vol:1155,reason:'ì§€ì£¼ì‚¬ ì²´ì œ ì „í™˜',keyword:'ì œì•½ë°”ì´ì˜¤'},{rank:3,name:'í˜„ëŒ€ADM',rate:29.93,vol:1938,reason:'ë°”ì´ì˜¤ ì‹ ì•½íŒ€ ê¸°ì§ˆ ì¥ë²½ ì…ì¦',keyword:'ì œì•½ë°”ì´ì˜¤'}].forEach(item=>{addRow('rise');const i=rC-1;document.getElementById(`rise-rk-${i}`).value=item.rank;document.getElementById(`rise-nm-${i}`).value=item.name;document.getElementById(`rise-rt-${i}`).value=item.rate;document.getElementById(`rise-vl-${i}`).value=item.vol;document.getElementById(`rise-rs-${i}`).value=item.reason;document.getElementById(`rise-kw-${i}`).value=item.keyword;});
  [{rank:1,name:'ë¯¸ë˜ì—ì…‹ì¦ê¶Œ',rate:14.42,vol:24603,reason:'ì½”ìŠ¤í”¼ ì—­ëŒ€ê¸‰ ë¶ˆì¥',keyword:'ì¦ê¶Œ'},{rank:2,name:'SKì´í„°ë‹‰ìŠ¤',rate:22.68,vol:9494,reason:'SK ì‹ ì¬ìƒì—ë„ˆì§€ ì¬í¸',keyword:'SKê·¸ë£¹'}].forEach(item=>{addRow('vol');const i=vC-1;document.getElementById(`vol-rk-${i}`).value=item.rank;document.getElementById(`vol-nm-${i}`).value=item.name;document.getElementById(`vol-rt-${i}`).value=item.rate;document.getElementById(`vol-vl-${i}`).value=item.vol;document.getElementById(`vol-rs-${i}`).value=item.reason;document.getElementById(`vol-kw-${i}`).value=item.keyword;});
  toast('ìƒ˜í”Œ ë¡œë“œë¨','info');
}

// â”€â”€ SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateInfo(){
  const dates=Object.keys(db).sort();
  const el=document.getElementById('dataInfo');
  if(el)el.innerHTML=`ì €ì¥ëœ ë‚ ì§œ: ${dates.length}ì¼<br>ìµœì‹ : ${dates[dates.length-1]||'ì—†ìŒ'}<br>ì´ ì¢…ëª©: ${Object.values(db).reduce((a,v)=>a+(v.rise?.length||0)+(v.vol?.length||0),0)}ê°œ`;
}
function exportJSON(){
  const json=JSON.stringify(db,null,2);
  const blob=new Blob([json],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');a.href=url;a.download=`stockradar_${toStr(new Date())}.json`;a.click();
  URL.revokeObjectURL(url);toast('ğŸ“¤ ë‚´ë³´ë‚´ê¸° ì™„ë£Œ','ok');
}
function clearAll(){if(!confirm('ì „ì²´ ì‚­ì œí• ê¹Œìš”?'))return;db={};save();loadView();toast('ì‚­ì œ ì™„ë£Œ','info');}
function deleteDay(){
  const date=document.getElementById('viewDate').value;
  if(!date||!db[date]){toast('ë°ì´í„° ì—†ìŒ','err');return;}
  if(!confirm(`${date} ì‚­ì œ?`))return;
  delete db[date];save();loadView();toast(`ğŸ—‘ ${date} ì‚­ì œ`,'info');
}

// â”€â”€ HELPER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function kwTag(kw){if(!kw)return '<span class="tag tag-def">-</span>';return `<span class="tag tag-${kw.toLowerCase().replace(/[^ê°€-í£a-z0-9]/g,'')}">${kw}</span>`;}
function toast(msg,type='ok'){const el=document.getElementById('toast');el.textContent=msg;el.className=`toast ${type} show`;clearTimeout(el._t);el._t=setTimeout(()=>el.classList.remove('show'),3000);}
</script>
</body>
</html>
